<div id="searchContainer">
	<div class="row">
		<div class="col-12 md">
			<form action="/spaces/search/" method="GET">
				<h1>City:</h1><br>
				<input type="text" name="city">
				<button type="submit">Search</button>
			</form>
		</div>
	</div>

	<div class="row">
		<div class="col-6 md" id="searchList">
			{{#if user}}
				{{#each user.space}}
					<div class="searchResult">
						<img src="{{this.photo}}" height="150px" width="150px">
						<a href="space/{{this.id}}"> <h5>Address: {{this.address}}</h5></a>
						<h5>{{this.city}}, {{this.state}}</h5>
						<h5>{{this.zipcode}}</h5>
						<h5>${{this.price}} / month</h5>
						<h5>Available from <strong>{{this.from}}</strong> until <strong>{{this.to}}</strong></h5>
					</div>
				{{/each}}
			{{else}}
				{{#each space}}
					<div class="searchResult">
						<img src="{{this.photo}}" height="150px" width="150px">
						<h5>{{this.type}}</h5>
						<a href="space/{{this.id}}"> <h5>Address: {{this.address}}</h5></a>
						<h5>{{this.city}}, {{this.state}}</h5>
						<h5>{{this.zipcode}}</h5>
						<h5>${{this.price}} / month</h5>
						<h5>Available from <strong>{{this.from}}</strong> until <strong>{{this.to}}</strong></h5>
					</div>
				{{/each}}
			{{/if}}
		</div>
		<div class="col-6 md">
			<div id="map"></div>
		</div>
	</div>
</div>
<script type="text/javascript">
var map;
var geocoder;

function getDefaultLocation(){
	if(navigator.geolocation){
		return navigator.geolocation.getCurrentPosition(showPosition);
	}
}

function showPosition(position){
	return position.coords.latitude;
}

function initMap(){
	geocoder = new google.maps.Geocoder();
	map = new google.maps.Map(document.getElementById('map'), {
		center: {lat: 30.2672, lng: -97.7431},
		zoom: 10
	});

	var searchListDiv = document.getElementById('searchList');
	var children = searchListDiv.children;

	{{#if user}}
		{{#each user.space}}
			var address = "{{this.address}}";
			var markerInfo = '<div class="markerInfo" style="width: 200px, height:200px">' +
				'{{this.type}}<br>{{this.address}}<br>{{this.price}} / month';

			var markerTitle = {{this.id}};

			var infoWindow = new google.maps.InfoWindow({
				content: markerInfo
			});

			geocoder.geocode({'address': address}, function(results, status){
				if(status == 'OK'){
					var marker = new google.maps.Marker({
						map: map,
						position: results[0].geometry.location,
						label: "R",
						title: markerTitle
					});
					marker.addListener('click', function(){
						infoWindow.open(map, marker);
					});
				}
			});
		{{/each}}
	{{else}}
		{{#each space}}
			var address = "{{this.address}}";
			var markerInfo = '<div class="markerInfo" style="width: 200px, height:200px">' +
				'{{this.type}}<br>{{this.address}}<br>{{this.price}} / month';

			console.log(markerInfo);

			var markerTitle = {{this.id}};

			var infoWindow = new google.maps.InfoWindow({
				content: markerInfo
			});

			geocoder.geocode({'address': address}, function(results, status){
				if(status == 'OK'){
					var marker = new google.maps.Marker({
						map: map,
						position: results[0].geometry.location,
						label: "R",
						title: markerTitle
					});
					marker.addListener('click', function(){
						infoWindow.open(map, marker);
					});
				}
			});
		{{/each}}
	{{/if}}

	/*for(var i = 0; i < children.length; i++){
		var address = children[i].children[2].children[0].innerHTML;
		address = address.substring(9, address.length);

		var markerInfo = '<div class="markerInfo" style="width: 200px, height: 200px">' +
			children[i].children[1].innerHTML + '<br>' +
			children[i].children[5].innerHTML + '<br>' +
			children[i].children[6].innerHTML;

		var markerTitle = children[i].children[1].innerHTML;

		var infoWindow = new google.maps.InfoWindow({
			content: markerInfo
		});

		geocoder.geocode({'address': address}, function(results, status){
			if(status == 'OK'){
				var marker = new google.maps.Marker({
					map: map,
					position: results[0].geometry.location,
					label: "R",
					title: markerTitle
				});
				marker.addListener('click', function(){
					infoWindow.open(map, marker);
				});
			}
		});
	}*/
}
</script>
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBJYlT151x978VdI9hNduUpuHR8rejvxdw&callback=initMap"></script>